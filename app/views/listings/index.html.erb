<div class="listing-filters">
  <div class="filters-heading">
    <i class="fa fa-sliders" aria-hidden="true"></i> Filters
  </div>
  <div class="ui vertical accordion">
    <div class="item">
      <div class="content">




        <form action="/listings" name="search-bar">
          <div class="filter-dropdowns">
            <select name="brand" class="ui search dropdown" id="brand" onchange='this.form.submit()'>
              <option value="">Brand</option>
              <% @brand_array.each do |brand|%>
              <option value="<%= brand %>"><%= brand %></option>
              <% end %>
            </select>

            <select name="model" class="ui search dropdown" id="model" onchange='this.form.submit()'>
              <option value="">Model</option>
              <% @model_array.each do |model|%>
              <option value="<%= model %>"><%= model %></option>
              <% end %>
            </select>
            <select name="min_price" class="ui search dropdown">
              <option value="">Min price</option>
            </select>
            <select name="max_price" class="ui search dropdown">
              <option value="">Max price</option>
            </select>
          </div>
        </form>




<form action="/listings" name="search-bar">
        <div class="filter-section">
          <% @brand_array.each_with_index do |brand, i|%>
          <div class="ui checked checkbox">
            <input type="checkbox" value="<%= params[:brand] %><%= " " + brand unless params[:brand].include? brand%>" name="brand" <%#= "checked=''" if params.values.first.include? brand %> onchange='this.form.submit()'>
            <label><%= brand %></label>
          </div>
          <% end %>
            <input type="hidden" value="<%= params[:model] %>" name="model">
            <input type="hidden" value="<%= params[:min_price] %>" name="min_price">
            <input type="hidden" value="<%= params[:max_price] %>" name="max_price">
        </div>
</form>


      </div>
    </div>
    <div class="item">
      <a class="title">
        <i class="dropdown icon"></i>
        Models
      </a>
      <div class="content">
        <div class="filter-section">
          <% @model_array.each do |model|%>
          <div class="ui checked checkbox">
            <input type="checkbox" name="<%= model %>" <%= "checked=''" if params[:model].include? model %>>
            <label><%= model %></label>
          </div>
          <% end %>
        </div>
      </div>
    </div>
    <div class="item">
      <a class="title">
        <i class="dropdown icon"></i>
        Price
      </a>
      <div class="content">
        <div class="filter-section">
          FROM ... TO
        </div>
      </div>
    </div>
    <div class="item">
      <a class="title">
        <i class="dropdown icon"></i>
        Location
      </a>
      <div class="content">
        <div class="filter-section">
          <div class="ui checkbox">
            <input type="checkbox" name="example">
            <label>Vienna</label>
          </div>
          <div class="ui checkbox">
            <input type="checkbox" name="example">
            <label>Brussels</label>
          </div>
          <div class="ui checkbox">
            <input type="checkbox" name="example">
            <label>London</label>
          </div>
          <div class="ui checkbox">
            <input type="checkbox" name="example">
            <label>Bangkok</label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="light-grey-bg listings-entries">

  <!-- testing -->







  <!-- testing end -->
  <% @listings.each do |listing| %>
  <div class="listing-card">
    <%= cl_image_tag(listing.photos.first.path, width: 300, height: 200, crop:"fill", class: "listing-picture") %>
    <div class="listing-details">
      <h2><%= link_to listing.title, listing_path(listing) %></h2>
      <h3><%= listing.price %> â‚¬</h3>
      <i class="fa fa-map-marker" aria-hidden="true"></i> <%= listing.city %> <i class="fa fa-tachometer" aria-hidden="true"></i> <%= listing.mileage %> <i class="fa fa-calendar" aria-hidden="true"></i> <%= listing.year %>
      <p>
        <%= truncate(listing.description, :length => 500) %>
      </p>
    </div>
    <div class="listing-actions">
      <div class="edit-actions">
        <% if current_user == listing.user %>
        <%= link_to edit_listing_path(listing), class: "ui icon button" do %>
        <i class="delete icon"></i>
        <% end %>
        <%= link_to listing_path(listing), method: :delete, data: { confirm: "Are you sure?" }, class: "ui icon delete-icon button" do %>
        <i class="edit icon"></i>
        <% end %>
        <% end %>
      </div>
      <div class="primary-action-button">
       <button class="ui primary basic button anim-trigger">Contact Seller</button>
       <% if Favorite.where(user_id: current_user, listing_id: listing).first %>
       <% favorite = Favorite.where(user_id: current_user, listing_id: listing).first %>
       <%= link_to listing_favorite_path(listing, favorite), method: :delete do%>
       <button class="ui icon button">
        <i class="red heart icon"></i>
      </button>
      <%end%>
      <% else %>
      <%= link_to listing_favorites_path(listing), method: :post do %>
      <button class="ui icon button">
        <i class="heart icon heart-anim-trigger"></i>
      </button>
      <%end%>
      <% end %>
    </div>
  </div>
</div>
<% end %>

<%= link_to "Add new listing", new_listing_path %>
</div>

<script type="text/javascript">
  $('.ui.accordion').accordion({
    exclusive: false
  })
  ;
</script>

<script type="text/javascript">
  $(".heart-anim-trigger").click(function(){
    $(".listings-entries").append('<div class="heart-anim"></div>')
    $(".heart-anim").append('<div class="heart-wrapper active"><div class="heart"><div class="tl"></div><div class="tr"></div><div class="bl"></div><div class="br"></div></div><div class="ring"></div><div class="circles"></div></div>').delay(2000).fadeOut();
    setTimeout(function() {
      $('.heart-anim').remove();
    }, 2500);;
    var h = document.querySelector('.heart-wrapper');

    function toggleActivate(){
      h.classList.toggle('active');
    }

    if(!debug){
      h.addEventListener('click',function(){
        toggleActivate();
      },false);

    // setInterval(toggleActivate,1000);
  }else{
    var elts = Array.prototype.slice.call(h.querySelectorAll(':scope > *'),0);
    var activated = false;
    var animating = false;
    var count = 0;
    var step = 1000;

    function setAnim(state){
      elts.forEach(function(elt){
        elt.style.animationPlayState = state;
      });
    }

    h.addEventListener('click',function(){
      if (animating) return;
      if (count > 27) {
        h.classList.remove('active');
        count = 0;
        return;
      }
      if (!activated) h.classList.add('active') && (activated = true);

      console.log('Step : '+(++count));
      animating = true;

      setAnim('running');
      setTimeout(function(){
        setAnim('paused');
        animating = false;
      },step);
    },false);

    setAnim('paused');
    elts.forEach(function(elt){
      elt.style.animationDuration = step/1000*27+'s';
    });
  }

});

</script>
